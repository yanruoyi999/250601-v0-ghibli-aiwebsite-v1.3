<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghibli AI å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success { border-left: 5px solid #4caf50; }
        .error { border-left: 5px solid #f44336; }
        .loading { border-left: 5px solid #ff9800; }
        img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
        }
        .progress-container {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 20px;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ Ghibli AI é¡¶çº§è´¨é‡å›¾ç‰‡ç”Ÿæˆå™¨ - å®Œæ•´æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ§ª APIåŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testAllAspectRatios()">æµ‹è¯•æ‰€æœ‰æ¯”ä¾‹</button>
        <button onclick="testQualityModes()">æµ‹è¯•è´¨é‡æ¨¡å¼</button>
        <button onclick="testAnatomyFocus()">æµ‹è¯•è§£å‰–å­¦ä¼˜åŒ–</button>
        <button onclick="testComplexScenes()">æµ‹è¯•å¤æ‚åœºæ™¯</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ é¡¶çº§è´¨é‡ç”Ÿæˆæµ‹è¯•</h2>
        <button onclick="generateWithProgress('a beautiful girl with perfect hands and face sitting in a magical garden', '3:4', 'hd')">HDè´¨é‡äººç‰©æµ‹è¯•</button>
        <button onclick="generateWithProgress('a dragon flying over ancient temple with perfect anatomy', '16:9', 'standard')">å¤æ‚åœºæ™¯æµ‹è¯•</button>
        <button onclick="generateWithProgress('two characters interacting naturally without overlapping', '1:1', 'hd')">äº¤äº’åœºæ™¯æµ‹è¯•</button>
        
        <div class="progress-container" id="progress-container" style="display: none;">
            <div class="progress-bar" id="progress-bar">0%</div>
        </div>
        
        <div id="generation-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ çœŸå®å‰åœåŠ›é£æ ¼ç”Ÿæˆæµ‹è¯•</h2>
        <button onclick="generateWithProgress('a young girl reading under a cherry blossom tree', '3:4', 'standard')">æ¨±èŠ±æ ‘ä¸‹é˜…è¯»</button>
        <button onclick="generateWithProgress('peaceful countryside village with rolling green hills', '16:9', 'hd')">ç”°å›­æ‘åº„é£æ™¯</button>
        <button onclick="generateWithProgress('cat sitting by a wooden window with soft sunlight', '1:1', 'standard')">çª—è¾¹å°çŒ«</button>
        <button onclick="generateWithProgress('child walking through a field of wildflowers', '3:4', 'hd')">é‡èŠ±ç”°é—´æ¼«æ­¥</button>
        <button onclick="generateWithProgress('cozy wooden cottage surrounded by forest', '4:3', 'standard')">æ£®æ—å°å±‹</button>
        
        <div class="progress-container" id="progress-container" style="display: none;">
            <div class="progress-bar" id="progress-bar">0%</div>
        </div>
        
        <div id="generation-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h2>
        <div id="performance-stats">
            <p>ç­‰å¾…æµ‹è¯•æ•°æ®...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸŒŸ å‰åœåŠ›é£æ ¼ç‰¹å¾éªŒè¯</h2>
        <button onclick="testGhibliCharacteristics()">æµ‹è¯•é£æ ¼ç‰¹å¾</button>
        <button onclick="testColorPalette()">æµ‹è¯•è‰²å½©æŸ”å’Œåº¦</button>
        <button onclick="testNaturalElements()">æµ‹è¯•è‡ªç„¶å…ƒç´ </button>
        <div id="style-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”¬ é€»è¾‘å‡†ç¡®æ€§ä¸“é¡¹æµ‹è¯•</h2>
        <button onclick="testAnatomyAccuracy()">æµ‹è¯•è§£å‰–å­¦å‡†ç¡®æ€§</button>
        <button onclick="testObjectLogic()">æµ‹è¯•ç‰©ä½“é€»è¾‘</button>
        <button onclick="testFacialSymmetry()">æµ‹è¯•é¢éƒ¨å¯¹ç§°æ€§</button>
        <button onclick="testComplexInteractions()">æµ‹è¯•å¤æ‚äº¤äº’åœºæ™¯</button>
        <button onclick="generateWithProgress('girl riding single broomstick in sky', '3:4', 'hd')">æ‰«å¸šéª‘è¡Œæµ‹è¯•</button>
        <div id="logic-results"></div>
    </div>

    <script>
        let testResults = [];

        async function apiTest(prompt, aspectRatio, quality, testName) {
            const startTime = Date.now();
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, aspectRatio, quality })
                });
                
                const data = await response.json();
                const endTime = Date.now();
                
                if (data.success) {
                    testResults.push({
                        test: testName,
                        time: endTime - startTime,
                        success: true,
                        size: data.settings.size,
                        steps: data.settings.steps,
                        seed: data.performance.seed
                    });
                    return { success: true, data, time: endTime - startTime };
                } else {
                    return { success: false, error: data.error, time: endTime - startTime };
                }
            } catch (error) {
                return { success: false, error: error.message, time: Date.now() - startTime };
            }
        }

        async function testAllAspectRatios() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•æ‰€æœ‰æ¯”ä¾‹...</div>';
            
            const ratios = [
                { ratio: '1:1', expected: '1024x1024', name: 'æ­£æ–¹å½¢' },
                { ratio: '4:3', expected: '1152x896', name: 'æ¨ªå‘' },
                { ratio: '3:4', expected: '896x1152', name: 'ç«–å‘' },
                { ratio: '16:9', expected: '1792x1024', name: 'è¶…å®½' },
                { ratio: '9:16', expected: '1024x1792', name: 'è¶…é«˜' }
            ];
            
            let results = '';
            for (const { ratio, expected, name } of ratios) {
                const result = await apiTest('a peaceful scene', ratio, 'standard', `æ¯”ä¾‹æµ‹è¯•_${ratio}`);
                if (result.success && result.data.settings.size === expected) {
                    results += `<div class="result success">âœ… ${name} (${ratio}): ${result.data.settings.size} - ${result.time}ms</div>`;
                } else {
                    results += `<div class="result error">âŒ ${name} (${ratio}): ${result.error || 'å°ºå¯¸é”™è¯¯'}</div>`;
                }
            }
            resultsDiv.innerHTML = results;
        }

        async function testQualityModes() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•è´¨é‡æ¨¡å¼...</div>';
            
            const standardResult = await apiTest('a test scene', '1:1', 'standard', 'æ ‡å‡†è´¨é‡æµ‹è¯•');
            const hdResult = await apiTest('a test scene', '1:1', 'hd', 'HDè´¨é‡æµ‹è¯•');
            
            let results = '';
            if (standardResult.success) {
                results += `<div class="result success">âœ… æ ‡å‡†è´¨é‡: ${standardResult.data.settings.steps}æ­¥ - ${standardResult.time}ms</div>`;
            }
            if (hdResult.success) {
                results += `<div class="result success">âœ… HDè´¨é‡: ${hdResult.data.settings.steps}æ­¥ - ${hdResult.time}ms</div>`;
            }
            
            resultsDiv.innerHTML = results;
        }

        async function testAnatomyFocus() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•è§£å‰–å­¦ä¼˜åŒ–...</div>';
            
            const result = await apiTest('a girl with beautiful hands and perfect facial features', '3:4', 'hd', 'è§£å‰–å­¦æµ‹è¯•');
            
            if (result.success) {
                const hasAnatomyKeywords = result.data.prompt.includes('perfect anatomy') && 
                                         result.data.prompt.includes('five fingers per hand') &&
                                         result.data.negativePrompt.includes('extra fingers');
                
                if (hasAnatomyKeywords) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… è§£å‰–å­¦ä¼˜åŒ–å·²å¯ç”¨
                    <br>æ­£é¢æç¤ºè¯é•¿åº¦: ${result.data.prompt.length}
                    <br>è´Ÿé¢æç¤ºè¯é•¿åº¦: ${result.data.negativePrompt.length}
                    <br>ç”Ÿæˆæ—¶é—´: ${result.time}ms</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ è§£å‰–å­¦å…³é”®è¯ç¼ºå¤±</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ è§£å‰–å­¦æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testComplexScenes() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•å¤æ‚åœºæ™¯...</div>';
            
            const complexPrompts = [
                'multiple characters without overlapping',
                'character holding objects with proper physics',
                'detailed architecture with correct perspective'
            ];
            
            let results = '';
            for (const prompt of complexPrompts) {
                const result = await apiTest(prompt, '16:9', 'hd', `å¤æ‚åœºæ™¯_${prompt.substring(0,20)}`);
                if (result.success) {
                    results += `<div class="result success">âœ… ${prompt}: ${result.time}ms</div>`;
                } else {
                    results += `<div class="result error">âŒ ${prompt}: ${result.error}</div>`;
                }
            }
            resultsDiv.innerHTML = results;
        }

        async function generateWithProgress(prompt, aspectRatio, quality) {
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const resultsDiv = document.getElementById('generation-results');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            // æ¨¡æ‹Ÿè¿›åº¦æ¡
            let progress = 5;
            const progressInterval = setInterval(() => {
                if (progress < 85) {
                    progress += Math.random() * 8 + 2;
                    progressBar.style.width = progress + '%';
                    progressBar.textContent = Math.round(progress) + '%';
                }
            }, 300);
            
            try {
                const startTime = Date.now();
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, aspectRatio, quality })
                });
                
                const data = await response.json();
                const endTime = Date.now();
                
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                progressBar.textContent = '100%';
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 2000);
                
                if (data.success) {
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            âœ… ç”ŸæˆæˆåŠŸï¼
                            <br>æç¤ºè¯: ${prompt}
                            <br>æ¯”ä¾‹: ${aspectRatio} (${data.settings.size})
                            <br>è´¨é‡: ${quality} (${data.settings.steps}æ­¥)
                            <br>æ€»æ—¶é—´: ${endTime - startTime}ms
                            <br>æ¨ç†æ—¶é—´: ${data.performance.apiTime}ç§’
                            <br>ç§å­: ${data.performance.seed}
                            <img src="${data.imageUrl}" alt="Generated Image">
                        </div>
                    `;
                    
                    testResults.push({
                        test: `æ‰‹åŠ¨ç”Ÿæˆ_${prompt.substring(0,20)}`,
                        time: endTime - startTime,
                        success: true,
                        size: data.settings.size,
                        steps: data.settings.steps,
                        seed: data.performance.seed
                    });
                    updatePerformanceStats();
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ ç”Ÿæˆå¤±è´¥: ${data.error}</div>`;
                }
            } catch (error) {
                clearInterval(progressInterval);
                progressContainer.style.display = 'none';
                resultsDiv.innerHTML = `<div class="result error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }

        function updatePerformanceStats() {
            const statsDiv = document.getElementById('performance-stats');
            const successTests = testResults.filter(t => t.success);
            const avgTime = successTests.reduce((sum, t) => sum + t.time, 0) / successTests.length;
            
            statsDiv.innerHTML = `
                <p>ğŸ“Š æ€»æµ‹è¯•: ${testResults.length}</p>
                <p>âœ… æˆåŠŸ: ${successTests.length}</p>
                <p>â±ï¸ å¹³å‡æ—¶é—´: ${Math.round(avgTime)}ms</p>
                <p>ğŸš€ æœ€å¿«: ${Math.min(...successTests.map(t => t.time))}ms</p>
                <p>ğŸŒ æœ€æ…¢: ${Math.max(...successTests.map(t => t.time))}ms</p>
            `;
        }

        async function testGhibliCharacteristics() {
            const resultsDiv = document.getElementById('style-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•å‰åœåŠ›é£æ ¼ç‰¹å¾...</div>';
            
            const result = await apiTest('gentle girl with soft smile in a peaceful garden', '1:1', 'standard', 'å‰åœåŠ›ç‰¹å¾æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasGhibliKeywords = prompt.includes('studio ghibli') && 
                                        prompt.includes('soft') && 
                                        prompt.includes('gentle') &&
                                        prompt.includes('hand-drawn');
                
                const avoidsRealistic = negativePrompt.includes('photorealistic') && 
                                      negativePrompt.includes('3d render') &&
                                      negativePrompt.includes('over-detailed');
                
                if (hasGhibliKeywords && avoidsRealistic) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… å‰åœåŠ›é£æ ¼ç‰¹å¾å®Œæ•´
                    <br>åŒ…å«å…³é”®è¯: Studio Ghibli, soft, gentle, hand-drawn
                    <br>é¿å…å†™å®åŒ–: photorealistic, 3D renderè¢«ç¦æ­¢
                    <br>æç¤ºè¯é•¿åº¦: ${result.data.prompt.length}
                    <br>è´Ÿé¢æç¤ºè¯é•¿åº¦: ${result.data.negativePrompt.length}</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ å‰åœåŠ›ç‰¹å¾ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ ç‰¹å¾æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testColorPalette() {
            const resultsDiv = document.getElementById('style-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•è‰²å½©æŸ”å’Œåº¦...</div>';
            
            const result = await apiTest('sunset over meadow with wildflowers', '16:9', 'hd', 'è‰²å½©æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasSoftColors = prompt.includes('soft muted colors') && 
                                    prompt.includes('low saturation') && 
                                    prompt.includes('gentle color harmony');
                
                const avoidsHarshColors = negativePrompt.includes('oversaturated') && 
                                        negativePrompt.includes('neon colors') &&
                                        negativePrompt.includes('high contrast');
                
                if (hasSoftColors && avoidsHarshColors) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… è‰²å½©ç³»ç»Ÿä¼˜åŒ–å®Œæˆ
                    <br>æŸ”å’Œè‰²å½©: soft muted colors, low saturation
                    <br>é¿å…åˆºçœ¼: oversaturated, neon colorsè¢«ç¦æ­¢
                    <br>ç”Ÿæˆæ—¶é—´: ${result.time}ms</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ è‰²å½©ä¼˜åŒ–ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ è‰²å½©æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testNaturalElements() {
            const resultsDiv = document.getElementById('style-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•è‡ªç„¶å…ƒç´ ...</div>';
            
            const result = await apiTest('forest path with dappled sunlight', '3:4', 'standard', 'è‡ªç„¶å…ƒç´ æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasNature = prompt.includes('nature landscapes') && 
                                prompt.includes('peaceful countryside') && 
                                prompt.includes('serene forests');
                
                const avoidsModern = negativePrompt.includes('modern') && 
                                   negativePrompt.includes('technology') &&
                                   negativePrompt.includes('urban cityscape');
                
                if (hasNature && avoidsModern) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… è‡ªç„¶å…ƒç´ å®Œæ•´èå…¥
                    <br>è‡ªç„¶æ™¯è§‚: nature landscapes, countryside, forests
                    <br>é¿å…ç°ä»£: modern, technologyè¢«æ’é™¤
                    <br>æ°›å›´è¥é€ : peaceful, serene mood</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ è‡ªç„¶å…ƒç´ ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ è‡ªç„¶å…ƒç´ æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testAnatomyAccuracy() {
            const resultsDiv = document.getElementById('logic-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•è§£å‰–å­¦å‡†ç¡®æ€§...</div>';
            
            const result = await apiTest('portrait of a girl with beautiful symmetrical face and natural hands', '1:1', 'hd', 'è§£å‰–å­¦å‡†ç¡®æ€§æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasAnatomyKeywords = prompt.includes('perfect human anatomy') && 
                                         prompt.includes('symmetrical facial features') && 
                                         prompt.includes('correct hand anatomy');
                
                const avoidsAnatomyErrors = negativePrompt.includes('asymmetrical eyes') && 
                                          negativePrompt.includes('extra fingers') &&
                                          negativePrompt.includes('malformed hands');
                
                if (hasAnatomyKeywords && avoidsAnatomyErrors) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… è§£å‰–å­¦å‡†ç¡®æ€§ç³»ç»Ÿå®Œå¤‡
                    <br>åŒ…å«: perfect human anatomy, symmetrical facial features
                    <br>æ’é™¤: asymmetrical eyes, extra fingers, malformed hands
                    <br>ç”Ÿæˆæ—¶é—´: ${result.time}ms</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ è§£å‰–å­¦å‡†ç¡®æ€§ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ è§£å‰–å­¦æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testObjectLogic() {
            const resultsDiv = document.getElementById('logic-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•ç‰©ä½“é€»è¾‘...</div>';
            
            const result = await apiTest('girl holding one flower in her hand', '3:4', 'hd', 'ç‰©ä½“é€»è¾‘æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasLogicKeywords = prompt.includes('single consistent object') && 
                                       prompt.includes('proper object interaction') && 
                                       prompt.includes('no penetrating objects');
                
                const avoidsLogicErrors = negativePrompt.includes('multiple same objects') && 
                                        negativePrompt.includes('penetrating objects') &&
                                        negativePrompt.includes('floating objects');
                
                if (hasLogicKeywords && avoidsLogicErrors) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… ç‰©ä½“é€»è¾‘ç³»ç»Ÿå®Œå–„
                    <br>ç¡®ä¿: single consistent object, proper interaction
                    <br>é¿å…: multiple objects, penetrating, floating
                    <br>ç”Ÿæˆæ—¶é—´: ${result.time}ms</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ ç‰©ä½“é€»è¾‘ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ ç‰©ä½“é€»è¾‘æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testFacialSymmetry() {
            const resultsDiv = document.getElementById('logic-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•é¢éƒ¨å¯¹ç§°æ€§...</div>';
            
            const result = await apiTest('close-up portrait of girl with perfectly symmetrical face', '1:1', 'hd', 'é¢éƒ¨å¯¹ç§°æ€§æµ‹è¯•');
            
            if (result.success) {
                const prompt = result.data.prompt.toLowerCase();
                const negativePrompt = result.data.negativePrompt.toLowerCase();
                
                const hasFacialKeywords = prompt.includes('symmetrical eyes') && 
                                        prompt.includes('matching eye shapes') && 
                                        prompt.includes('properly aligned facial features');
                
                const avoidsFacialErrors = negativePrompt.includes('asymmetrical face') && 
                                         negativePrompt.includes('misaligned eyes') &&
                                         negativePrompt.includes('different eye styles');
                
                if (hasFacialKeywords && avoidsFacialErrors) {
                    resultsDiv.innerHTML = `<div class="result success">âœ… é¢éƒ¨å¯¹ç§°æ€§ç³»ç»Ÿä¼˜åŒ–
                    <br>ç¡®ä¿: symmetrical eyes, matching shapes, aligned features
                    <br>é¿å…: asymmetrical face, misaligned eyes
                    <br>æ¨ç†æ­¥æ•°: ${result.data.settings.steps}</div>`;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">âŒ é¢éƒ¨å¯¹ç§°æ€§ä¸å®Œæ•´</div>`;
                }
            } else {
                resultsDiv.innerHTML = `<div class="result error">âŒ é¢éƒ¨å¯¹ç§°æ€§æµ‹è¯•å¤±è´¥: ${result.error}</div>`;
            }
        }

        async function testComplexInteractions() {
            const resultsDiv = document.getElementById('logic-results');
            resultsDiv.innerHTML = '<div class="result loading">æµ‹è¯•å¤æ‚äº¤äº’åœºæ™¯...</div>';
            
            const complexScenarios = [
                'girl sitting on single chair reading one book',
                'character holding exactly one object with both hands',
                'person walking with proper body proportions'
            ];
            
            let results = '';
            for (const scenario of complexScenarios) {
                const result = await apiTest(scenario, '4:3', 'standard', `å¤æ‚äº¤äº’_${scenario.substring(0,15)}`);
                if (result.success) {
                    results += `<div class="result success">âœ… ${scenario.substring(0,30)}...: ${result.time}ms</div>`;
                } else {
                    results += `<div class="result error">âŒ ${scenario.substring(0,30)}...: ${result.error}</div>`;
                }
            }
            resultsDiv.innerHTML = results;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºçŠ¶æ€
        window.onload = function() {
            console.log('ğŸ¨ Ghibli AI é¡¶çº§è´¨é‡å›¾ç‰‡ç”Ÿæˆå™¨å·²å‡†å¤‡å°±ç»ªï¼');
        };
    </script>
</body>
</html> 